<!DOCTYPE html>
<html>

<head>
	<script src="https://kit.fontawesome.com/516da99189.js" crossorigin="anonymous"></script>
	<link rel="stylesheet" href="/css/write.css">
	<link rel="stylesheet" href="/css/summernote/summernote-lite.css">
	<link rel="stylesheet" href="/css/date/daterangepicker.css">
</head>

<body>
	<div class="container">
		<!-- 헤더 -->
		<div class="writeheader">
			<div class="writeheaderleft">
				<img class=logo src="/images/GivuLuv_logo.png" alt="">
				<p>글쓰기</p>
			</div>
			<a href="javascript:submit();" class="btn">등록</a>
		</div>
		
		<!-- 컨텐츠 -->
		
		<div class="wrap donationwrite write">
			<form method="post" name="donationForm">
				<input type="text" id="d_title" class="title" name="d_title" placeholder="제목">
				<div class="calendar_box">
					<i class="fa-solid fa-calendar"></i>
					<input type="text" id="datetime" class="datetime" readonly>
					<input type="hidden" id="dEnddate" name="dEnddate">
				</div>
				<textarea id="summernote" name="editordata" class="content"></textarea>
				<!-- targetAmount, dEnddate v, orgid v-->
				<input type="hidden" id="d_content" name="d_content">
				<input type="hidden" id="orgid" name="orgid" value="${session.orgid}">
				<div class="targetAmount_box">
					<i class="fa-solid fa-won-sign"></i>
					<input type="text" id="targetAmount" class="targetAmount" placeholder="목표 금액">
					<input type="hidden" id="realtargetAmount" name="targetAmount">
				</div>
				
				<!--<input type="button" class="files" name="files" value="">-->
				
			</form>
		</div>
	</div>

</body>
<script src="/js/jquery-3.7.1.min.js"></script>
<script src="/js/summernote/summernote-lite.js"></script>
<script src="/js/summernote/lang/summernote-ko-KR.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>

<script>
	var pattern_num = /[0-9]/;	// 숫자 
	var pattern_eng = /[a-zA-Z]/;	// 문자 
	var pattern_spc = /[~!@#$%^&*()_+|<>?:{}]/; // 특수문자
	var pattern_kor = /[ㄱ-ㅎ|ㅏ-ㅣ|가-힣]/; // 한글체크
	
	var files = [];
	
	//목표 금액 유효성 검사 + ','찍어주기
	$("#targetAmount").keyup(function(){
		let targetAmount = $("#targetAmount").val().replace(/[^\d]/g, '');
		targetAmount = targetAmount.replace(/,/g, '');
		
		//if문 안이 유효성 검사
		if(!(pattern_eng.test(targetAmount)) && !(pattern_spc.test(targetAmount)) && !(pattern_kor.test(targetAmount)) ){
			// 진짜 realAmount를 넘겨줄 요소에 삽입
			$("#realtargetAmount").val(targetAmount);
			
			// ',' 찍어서 보여주기
			let result = targetAmount.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',')
			$("#targetAmount").val(result);
			console.log(result);
			return true;
		}else{
		    alert("숫자만 입력 가능합니다.");
			$("#targetAmount").val('');
		    return false;
		}
	})
	
	
	
	//캘린더
		$(function () {
			$('#datetime').daterangepicker({
				singleDatePicker: true,
				showDropdowns: true,
				minYear: parseInt(moment().format('YYYY')),
				maxYear: parseInt(moment().format('YYYY')) + 5
			},
				function (start, end, label) {
					var days = moment().diff(start, 'days');
					if(days>0){
						alert(moment().format('MM/DD/YYYY')+"이후로 설정해주세요!");
						$('#datetime').val(moment().format('MM/DD/YYYY'));
						$('#datetime').focus();
					}
					else{
						//히든 input에 양식 맞춰서 시간 넣기
						console.log(start.format('YYYY-MM-DD'))
						$('#dEnddate').val(start.format('YYYY-MM-DD'))
					}
					
				});
	
		});
	
	//섬머노트
	$(document).ready(function () {
		//여기 아래 부분
		$('#summernote').summernote({
			height: 300,                 // 에디터 높이
			minHeight: null,             // 최소 높이
			maxHeight: null,             // 최대 높이
			focus: true,                  // 에디터 로딩후 포커스를 맞출지 여부
			lang: "ko-KR",               // 한글 설정
			placeholder: '최대 2048자까지 쓸 수 있습니다'   //placeholder 설정
		});
	});
	$('#summernote').summernote({
		placeholder: '글을 작성해주세요.',
		minHeight: 600,             // 최소 높이
		maxHeight: 600,             // 최대 높이
		height: 600,              // 기초 높이
		tabsize: 2,
		focus: true,
		lang: "ko-KR",
		toolbar: [              // 툴바 설정
			['fontname', ['fontname']],
			['fontsize', ['fontsize']],
			['style', ['bold', 'italic', 'underline', 'strikethrough', 'clear']],
			['font', ['bold', 'underline', 'clear']],
			['color', ['forecolor', 'color']],
			['table', ['table']],
			['para', ['ul', 'ol', 'paragraph']],
			['height', ['height']],
			['insert', ['link', 'picture']],
			['view', ['help']]
		],
		fontNames: ['Arial', 'Arial Black', 'Comic Sans MS', 'Courier New', '맑은 고딕', '궁서', '굴림체', '굴림', '돋움체', '바탕체'],
		fontSizes: ['8', '9', '10', '11', '12', '14', '16', '18', '20', '22', '24', '28', '30', '36', '50', '72'],
		callbacks: {   //이미지를 첨부
			onImageUpload: function (files) {
				uploadSummernoteImageFile(files[0], this);
			},
			onPaste: function (e) {
				var clipboardData = e.originalEvent.clipboardData;
				if (clipboardData && clipboardData.items && clipboardData.items.length) {
					var item = clipboardData.items[0];
					if (item.kind === 'file' && item.type.indexOf('image/') !== -1) {
						e.preventDefault();
					}
				}
			}
		}
	});
	function uploadSummernoteImageFile(file, editor) {
		data = new FormData();
		data.append("file", file);

		console.log('사진 넣기');

		$.ajax({
			data: data,
			type: "POST",
			url: "/file/uploadSummernoteImageFile",
			contentType: false,
			processData: false,
			success: function (data) {
				//항상 업로드된 파일의 url이 있어야 한다.
				$(editor).summernote('insertImage', data.url);

				let filename = data.url.substring(17);
				files.push(filename);
			}
		});
	}

	/*보류 파일 삭제
	function deleteSummernoteImageFile(imageName) {
		console.log("사진 삭제 : "+ imageName)
		let idx = files.indexOf(imageName);
		if(idx > -1){
			files.splice(idx, 1)
		}
		console.log(files);
		
	}*/



	function submit() {
		
		// 내용 유효성검사 + input:hidden에 삽입
		let content = $(".note-editable").html();
		console.log("content : " + content);
		$("#d_content").val(content);
		console.log("d_content 삽입 : " + $("#d_content").val())

		/* 보류 파일 삭제
		$(".files").val(files);
		console.log($(".files".val()));
		*/
		
		// 목표 금액 유효성 검사
		let targetAmount = $("#targetAmount").val();
		if(pattern_num.test(targetAmount)){
			console.log(targetAmount);
			return true;
		}
		else{
			alert("목표 금액을 작성해주세요!");
			$("#targetAmount").focus();
			return false;
		}
		
	}


</script>
<script>
	
</script>

</html>