<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>donation</title>
	<script src="https://kit.fontawesome.com/516da99189.js" crossorigin="anonymous"></script>
	<link rel="stylesheet" href="/css/managerModal.css"> 
<link rel="stylesheet" href="/css/donation.css">
<link rel="stylesheet" href="/css/header_footer.css">
<link rel="icon" href="/images/ê¸°ë¶€ëŸ¬ë¸Œ.ico" type="image/x-icon">
</head>
<body>
   <!-- header -->
   <th:block th:replace="~{layout/header::header(loginUser)}"></th:block>
   <!-- ì»¨í…ì¸  -->
   <div class="wrap donation">
		<div class="intro_donation">
				<h2>GivuLuv ì¶”ì²œ ëª¨ê¸ˆí•¨</h2>
			<div class="category_wrap">
				<ul class="category_list">
					<li class="category_item_1" aria-current="true">
						<button type="button" class="categoryBtn selected" data-orgcategory="ì „ì²´">
							<span class="DonationTodayCategory_text__2oRHp">ì „ì²´</span>
						</button>
					</li>
					<li class="category_item_2" aria-current="true">
						<button type="button" class="categoryBtn" data-orgcategory="ë™ë¬¼">
							<span class="DonationTodayCategory_text__2oRHp">ë™ë¬¼</span>
						</button>
					</li>
					<li class="category_item_3" aria-current="true">
						<button type="button" class="categoryBtn" data-orgcategory="ì•„ë™â€¢ì²­ì†Œë…„">
							<span class="DonationTodayCategory_text__2oRHp">ì•„ë™â€¢ì²­ì†Œë…„</span>
						</button>
					</li>
					<li class="category_item_4" aria-current="true">
						<button type="button" class="categoryBtn" data-orgcategory="ì–´ë¥´ì‹ ">
							<span class="DonationTodayCategory_text__2oRHp">ì–´ë¥´ì‹ </span>
						</button>
					</li>
					<li class="category_item_5" aria-current="true">
						<button type="button" class="categoryBtn" data-orgcategory="ì¥ì• ì¸">
							<span class="DonationTodayCategory_text__2oRHp">ì¥ì• ì¸</span>
						</button>
					</li>
					<li class="category_item_6" aria-current="true">
						<button type="button" class="categoryBtn" data-orgcategory="ë‹¤ë¬¸í™”">
							<span class="DonationTodayCategory_text__2oRHp">ë‹¤ë¬¸í™”</span>
						</button>
					</li>
					<li class="category_item_7" aria-current="true">
						<button type="button" class="categoryBtn" data-orgcategory="ì§€êµ¬ì´Œ">
							<span class="DonationTodayCategory_text__2oRHp">ì§€êµ¬ì´Œ</span>
						</button>
					</li>
					<li class="category_item_8" aria-current="true">
						<button type="button" class="categoryBtn" data-orgcategory="ì‹œë¯¼ì‚¬íšŒ">
							<span class="DonationTodayCategory_text__2oRHp">ì‹œë¯¼ì‚¬íšŒ</span>
						</button>
					</li>
					<li class="category_item_9" aria-current="true">
						<button type="button" class="categoryBtn" data-orgcategory="í™˜ê²½">
							<span class="DonationTodayCategory_text__2oRHp">í™˜ê²½</span>
						</button>
					</li>
					<li class="category_item_10" aria-current="true">
						<button type="button" class="categoryBtn" data-orgcategory="ê°€ì¡±â€¢ì—¬ì„±">
							<span class="DonationTodayCategory_text__2oRHp">ê°€ì¡±â€¢ì—¬ì„±</span>
						</button>
					</li>
					<li class="category_item_11" aria-current="true">
						<button type="button" class="categoryBtn" data-orgcategory="ê¸°íƒ€">
							<span class="DonationTodayCategory_text__2oRHp">ê¸°íƒ€</span>
						</button>
					</li>
				</ul>
			<div class="card_list">
				<div class="card_list2">
					<!-- ë§¨ì²˜ìŒ ê¸°ë¶€í˜ì´ì§€ ëˆŒë €ì„ ë•Œ -->
					<th:block th:if="${not #lists.isEmpty(list)}">
						<th:block th:each="dBoard : ${list}">
						    <div class="card_item">
						        <a th:href="${dBoard.dBoard.dBoardnum}" id="donation_link" class="get">
						            <div class="card_thumbnail">
						                <img th:src="${dBoard.systemname}">
						            </div>
						            <strong class="card_title" th:text="${dBoard.dBoard.dTitle}"></strong>
						            <strong class="card_orgname" th:text="${dBoard.orgname}"></strong>
						        </a>
						    </div>
						</th:block>
					<th:block th:unless="${not #lists.isEmpty(list)}">
					    <p>ë“±ë¡ëœ ê¸°ë¶€ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>
					</th:block>
					<!-- ì—¬ê¸°ì„œë¶€í„°ëŠ” ë”êµ¬í˜„ë¨ -->
				</div>
				<div class="moreBtn">
					<input type="button" value="ë”ë³´ê¸°" id="more">
				</div>
			</div>
			<div class="today_donation">
				<h3 class="today_danation_title">
					<span class="blind">ì˜¤ëŠ˜ í•¨ê»˜í•œ ê¸°ë¶€ê¸ˆ<br> ì´ë§Œí¼ ëª¨ì˜€ì–´ìš”!</span>
				</h3>
				<div class="donation_today_summary">
					<span class="today_donation_summary people">ğŸ˜„ [[${todayDonationPeople}]]ëª…</span>					
					<span class="today_donation_summary cost">â¤ï¸ [[${todayCost}]]ì›</span>
				</div>
			</div>
			<div class="donation_review_wrap">
				<h3 class="donation_review_title">ì‘ì› ë©”ì‹œì§€</h3>
				<div class="donation_review_card_list_wrap">
					<ul class="donation_review_card_list">
						<li th:each="review : ${reviewWithTitle}" class="donation_review_card_list_item">
							<a th:href="@{/donation/donationView(dBoardnum=${review.review.connectid})}" class="donation_review_card_list_link">
								<div class="donation_review_card_list_review_top">
									<div class="donation_review_card_list_thumb">
										<img th:src="${review.systemname}" width="70" height="70" alt=""
											class="donation_review_card_list_image">
									</div>
									<strong class="donation_review_card_title" th:text="${review.boardtitle}"></strong>
								</div>
								<div class="donation_review_card_list_info">
									<span class="donation_review_card_list_text" th:text="${review.review.reviewdetail}"></span>
								</div>
							</a>
						</li>
					</ul>
				</div>
			</div>
		</div>
	</div>
   <!-- ê´€ë¦¬ì ìŠ¹ì¸ì—¬ë¶€ ëª¨ë‹¬ì°½ -->
   <th:block th:replace="~{layout/managerModal::managerModal()}"></th:block>
   <!-- footer -->
   <th:block th:replace="~{layout/footer::footer()}"></th:block>
</body>
<script src="/js/jquery-3.7.1.min.js"></script>
<script src="/js/managerModal.js"></script>
<script th:inline="javascript">
	$('.h_logout').on('click', function(){
		alert("ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤.")
	})
	
	$(document).ready(function() {
		    $('.categoryBtn').click(function() {
		        // í´ë¦­ëœ ì¹´í…Œê³ ë¦¬ ë²„íŠ¼ì—ë§Œ selected í´ë˜ìŠ¤ë¥¼ ì¶”ê°€í•˜ê³  ë‚˜ë¨¸ì§€ì—ì„œëŠ” ì œê±°
		        $('.categoryBtn').removeClass('selected');
		        $(this).addClass('selected');
		    });
					// í•œ ë²ˆì— í‘œì‹œí•  ì•„ì´í…œì˜ ê°œìˆ˜ ì„¤ì •
				    let itemsPerPage = 8;
				
				    // ì•„ì´í…œì˜ ì´ ê°œìˆ˜
				    let totalItems = $('.card_item').length;
				    // ì´ˆê¸°ì—ëŠ” itemsPerPage ê°œìˆ˜ê¹Œì§€ë§Œ í‘œì‹œë˜ë„ë¡ ì„¤ì •
				    $('.card_item:gt(' + (itemsPerPage - 1) + ')').hide();
				
				    // ì•„ì´í…œì´ itemsPerPage ê°œìˆ˜ ì´í•˜ì´ë©´ ë”ë³´ê¸° ë²„íŠ¼ ìˆ¨ê¸°ê¸°
				    if (totalItems <= itemsPerPage) {
				        $('#more').hide();
				    }
					$(".get").on("click", function (e) {
						e.preventDefault();
						let dBoardnum = $(this).attr("href");
						location.href = "donationView?dBoardnum=" + dBoardnum;
					})
				    // ë”ë³´ê¸° ë²„íŠ¼ í´ë¦­ ì‹œ
				    $('#more').on('click', function () {
				        // itemsPerPage ê°œìˆ˜ ë§Œí¼ ì¶”ê°€ë¡œ í‘œì‹œ
				        $('.card_item:hidden').slice(0, itemsPerPage).slideDown();
				        // ì•„ì§ í‘œì‹œí•˜ì§€ ì•Šì€ ì•„ì´í…œì˜ ê°œìˆ˜ ê°±ì‹ 
				        totalItems -= itemsPerPage;
				        // ë‚¨ì€ ì•„ì´í…œì´ itemsPerPage ê°œìˆ˜ ì´í•˜ì´ë©´ ë”ë³´ê¸° ë²„íŠ¼ ìˆ¨ê¸°ê¸°
				        if (totalItems <= itemsPerPage) {
				            $('#more').hide();
				        }
				    });
			});
		$(document).ready(function () {
				// ì¹´í…Œê³ ë¦¬ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
				$('.categoryBtn').click(function () {
					let orgcategory = $(this).data('orgcategory');
					fetchCategoryItems(orgcategory);
				});

				function fetchCategoryItems(orgcategory) {
					$.ajax({
						url: '/donation/getCategoryItems',
						type: 'Get',
						data: {orgcategory: orgcategory},
						dataType: 'json',
						success: function (data) {
							$('.card_list2').empty();
							console.log(data);
							if (data.length > 0) {
								$.each(data, function (index, item) {
									console.log(item);
									let dBoard = item.dboard;
									let orgname = item.orgname;
									let systemname = item.systemname;
									console.log(systemname);
									let cardItem = `
									 <div class="card_item">
										<a href="donationView?dBoardnum=${dBoard.dboardnum}" id="donation_link" class="get">
											<div class="card_thumbnail">
												<img src="${systemname}">
											</div>
											<strong class="card_title">${dBoard.dtitle}</strong>
											<strong class="card_orgname">${orgname}</strong>
										</a>
									</div>`;
									$('.card_list2').append(cardItem);
								});
							} else {
								// ë§Œì•½ ë°›ì€ ë°ì´í„°ê°€ ì—†ë‹¤ë©´ ë©”ì‹œì§€ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.
								console.log("ì—†ìŒ");
								$('.card_list2').append('<p>ë“±ë¡ëœ ê¸°ë¶€ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>');
								$('.card_list2').css("text-align", "center");
								$('.card_list2 p').css("line-height", "200px");
								
							}
							let itemCount = $('.card_item').length;
							let hidden = $('.card_item:hidden').length
							console.log("ê¸€ê°œìˆ˜: "+itemCount)
							console.log("íˆë“ : "+hidden)
							    $('.card_item').hide();
							    $('.card_item:lt(8)').show();

							    if (itemCount > 8) {
							         $('#more').show();
							    } else {
							         $('#more').hide();
								}
								$('#more').off('click').on('click', function () {
								     $('.card_item:hidden').slice(0, 8).slideDown();
								                
								     // ëª¨ë“  ì•„ì´í…œì´ í‘œì‹œë˜ì—ˆì„ ê²½ìš° ë”ë³´ê¸° ë²„íŠ¼ì„ ìˆ¨ê¹ë‹ˆë‹¤.
								     if ($('.card_item:hidden').length === 0) {
								         $('#more').hide();
								     }
								});

						},
						error: function (xhr, status, error) {
							console.error('AJAX Error: ', status, error);
						}
					});
				}	
			});
			
</script>

</html>